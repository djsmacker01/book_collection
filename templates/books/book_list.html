<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Books - Book Collection</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>

<body>
    <div class="container">
        <h1>üìö All Books in Collection</h1>

        <div class="nav-links">
            <a href="{% url 'home' %}">Home</a>
            <a href="{% url 'add_book' %}">Add Book</a>
            <a href="/admin/">Admin Panel</a>
        </div>

        <!-- Search and Filter Section -->
        <div class="search-filter-section">
            <form method="GET" class="search-form">
                <div class="search-row">
                    <input type="text" name="search" placeholder="Search books by title, author, or description..."
                        value="{{ search_query }}" class="search-input">
                    <button type="submit" class="search-btn">üîç Search</button>
                </div>

                <div class="filter-row">
                    <select name="genre" class="filter-select">
                        <option value="">All Genres</option>
                        {% for value, label in genre_choices %}
                        <option value="{{ value }}" {% if genre_filter==value %}selected{% endif %}>
                            {{ label }}
                        </option>
                        {% endfor %}
                    </select>

                    <select name="sort" class="filter-select">
                        <option value="title" {% if sort_by=='title' %}selected{% endif %}>Sort by Title</option>
                        <option value="author" {% if sort_by=='author' %}selected{% endif %}>Sort by Author</option>
                        <option value="price_low" {% if sort_by=='price_low' %}selected{% endif %}>Price: Low to High
                        </option>
                        <option value="price_high" {% if sort_by=='price_high' %}selected{% endif %}>Price: High to Low
                        </option>
                        <option value="date_new" {% if sort_by=='date_new' %}selected{% endif %}>Date: Newest First
                        </option>
                        <option value="date_old" {% if sort_by=='date_old' %}selected{% endif %}>Date: Oldest First
                        </option>
                    </select>

                    <button type="submit" class="filter-btn">Apply Filters</button>
                    <a href="{% url 'book_list' %}" class="clear-btn">Clear All</a>
                </div>
            </form>
        </div>

        <div class="stats">
            <p>Found {{ books.count }} book{{ books.count|pluralize }}</p>
            {% if search_query or genre_filter %}
            <p class="filter-info">
                {% if search_query %}Searching for: "{{ search_query }}"{% endif %}
                {% if search_query and genre_filter %} ‚Ä¢ {% endif %}
                {% if genre_filter %}Genre: {{ genre_filter|title }}{% endif %}
            </p>
            {% endif %}
        </div>

        {% if books %}
        <div class="books-grid">
            {% for book in books %}
            <div class="book-card" onclick="window.location.href='{% url 'book_detail' book.id %}'">
                <img src="{{ book.get_cover_url }}" alt="{{ book.title }}" class="book-cover"
                    onerror="this.src='{% static 'images/default-book-cover.jpg' %}'">
                <div class="book-title">{{ book.title }}</div>
                <div class="book-author">by {{ book.author }}</div>
                <div class="book-price">{{ book.formatted_price }}</div>
                <div class="book-genre">{{ book.get_genre_display_name }}</div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="text-align: center; color: #666; font-style: italic; margin: 40px 0;">
            <h2>No books found!</h2>
            <p>Add some books through the <a href="/admin/">admin panel</a> to get started.</p>
        </div>
        {% endif %}
    </div>
</body>

</html>